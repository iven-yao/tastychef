let express = require('express');
let axios = require('axios').default;
let path = require('path');
let app = express();
require('dotenv').config()

let apiKey = {
  'X-RapidAPI-Key': process.env.API_KEY,
  'X-RapidAPI-Host': process.env.API_HOST
};

const PORT = process.env.PORT;
app.listen(PORT, () => console.log(`App listening on port ${PORT}!`));
app.use(express.static(path.join(__dirname, "public")));
app.set('view engine', 'ejs');

// let getRecipesList = async (from, size, tags, q) => {
//   const options = {
//     method: 'GET',
//     url: 'https://tasty.p.rapidapi.com/recipes/list',
//     params: {
//       from: from,
//       size: size,
//       tags: tags,
//       q: q
//     },
//     headers: apiKey
//   };
//   let response = await axios.request(options);
//   return response.data;
// }

let getRecipesList = (from, size, tags, q) => {
  // mimic func
  let response = JSON.parse("{\n    \"count\": 2216,\n    \"results\": [\n        {\n            \"video_id\": 191376,\n            \"slug\": \"pandan-creme-brulee\",\n            \"prep_time_minutes\": null,\n            \"yields\": \"6 servings\",\n            \"cook_time_minutes\": null,\n            \"promotion\": \"full\",\n            \"servings_noun_plural\": \"servings\",\n            \"is_shoppable\": true,\n            \"total_time_tier\": null,\n            \"price\": {\n                \"total\": 1600,\n                \"updated_at\": \"2023-05-15T07:30:54+02:00\",\n                \"portion\": 250,\n                \"consumption_total\": 950,\n                \"consumption_portion\": 150\n            },\n            \"nutrition\": {\n                \"fat\": 67,\n                \"calories\": 696,\n                \"sugar\": 23,\n                \"carbohydrates\": 22,\n                \"fiber\": 0,\n                \"updated_at\": \"2023-05-11T08:02:01+02:00\",\n                \"protein\": 17\n            },\n            \"buzz_id\": null,\n            \"total_time_minutes\": null,\n            \"is_one_top\": false,\n            \"video_ad_content\": \"none\",\n            \"canonical_id\": \"recipe:8660\",\n            \"country\": \"US\",\n            \"instructions\": [\n                {\n                    \"display_text\": \"Preheat the oven to 325°F (160°C).\",\n                    \"start_time\": 0,\n                    \"appliance\": \"oven\",\n                    \"end_time\": 0,\n                    \"temperature\": 325,\n                    \"id\": 74836,\n                    \"position\": 1\n                },\n                {\n                    \"temperature\": null,\n                    \"id\": 74837,\n                    \"position\": 2,\n                    \"display_text\": \"In a large bowl, whisk together the egg yolks and ¾–1 cup of sugar (depending on your sweetness preference) until smooth.\",\n                    \"start_time\": 6000,\n                    \"appliance\": null,\n                    \"end_time\": 10333\n                },\n                {\n                    \"appliance\": null,\n                    \"end_time\": 11666,\n                    \"temperature\": null,\n                    \"id\": 74838,\n                    \"position\": 3,\n                    \"display_text\": \"Add the heavy cream to a medium pot and warm over medium heat just until steam starts rising from the cream, about 3 minutes. DO NOT let it boil! Turn off the heat.\",\n                    \"start_time\": 10833\n                },\n                {\n                    \"temperature\": null,\n                    \"id\": 74839,\n                    \"position\": 4,\n                    \"display_text\": \"While whisking, slowly pour about ½ cup of the hot cream into the egg and sugar mixture (this is called tempering, allowing us to gently heat the eggs without causing them to curdle).\",\n                    \"start_time\": 12333,\n                    \"appliance\": null,\n                    \"end_time\": 14000\n                },\n                {\n                    \"start_time\": 14000,\n                    \"appliance\": null,\n                    \"end_time\": 16166,\n                    \"temperature\": null,\n                    \"id\": 74840,\n                    \"position\": 5,\n                    \"display_text\": \"Slowly pour the egg mixture into the pot with the remaining heavy cream and whisk to combine. Add the pandan extract and vanilla, then remove the pot from the heat.\"\n                },\n                {\n                    \"appliance\": null,\n                    \"end_time\": 19666,\n                    \"temperature\": null,\n                    \"id\": 74841,\n                    \"position\": 6,\n                    \"display_text\": \"Place 6 medium ramekins in a baking dish with sides the same height (or taller) than the ramekins. Dividing evenly, ladle the egg mixture through a fine-mesh sieve into the ramekins to catch any clumps and create a super-smooth consistency. If you’d like, skim off excess foam from the surface.\",\n                    \"start_time\": 17000\n                },\n                {\n                    \"display_text\": \"Carefully pour the hot water into the pan, being careful not to splash into the ramekins (the water bath will help the crème brûlée cook evenly).\",\n                    \"start_time\": 0,\n                    \"appliance\": null,\n                    \"end_time\": 0,\n                    \"temperature\": null,\n                    \"id\": 74842,\n                    \"position\": 7\n                },\n                {\n                    \"position\": 8,\n                    \"display_text\": \"Carefully transfer the pan with the ramekins to the oven. If desired, throw the ice cubes into the bottom of the oven to create a more humid baking environment.\",\n                    \"start_time\": 0,\n                    \"appliance\": null,\n                    \"end_time\": 0,\n                    \"temperature\": null,\n                    \"id\": 74843\n                },\n                {\n                    \"temperature\": null,\n                    \"id\": 74844,\n                    \"position\": 9,\n                    \"display_text\": \"Bake for 35–40 minutes, or until the custard has set and the centers are only slightly jiggly.\",\n                    \"start_time\": 0,\n                    \"appliance\": null,\n                    \"end_time\": 0\n                },\n                {\n                    \"temperature\": null,\n                    \"id\": 74845,\n                    \"position\": 10,\n                    \"display_text\": \"Remove from the oven and let cool at room temperature for 2 hours, then remove the ramekins from the water bath, cover, and refrigerate overnight.\",\n                    \"start_time\": 0,\n                    \"appliance\": null,\n                    \"end_time\": 0\n                },\n                {\n                    \"start_time\": 25666,\n                    \"appliance\": null,\n                    \"end_time\": 27000,\n                    \"temperature\": null,\n                    \"id\": 74846,\n                    \"position\": 11,\n                    \"display_text\": \"The next day, sprinkle 1 tablespoon of sugar over each crème brûlée and use a kitchen torch to melt until bubbly and dark golden. Let sit for a few minutes to solidify.\"\n                },\n                {\n                    \"display_text\": \"Top with your fruits of choice and serve.\",\n                    \"start_time\": 28000,\n                    \"appliance\": null,\n                    \"end_time\": 29833,\n                    \"temperature\": null,\n                    \"id\": 74847,\n                    \"position\": 12\n                },\n                {\n                    \"start_time\": 0,\n                    \"appliance\": null,\n                    \"end_time\": 3666,\n                    \"temperature\": null,\n                    \"id\": 74848,\n                    \"position\": 13,\n                    \"display_text\": \"Enjoy!\"\n                }\n            ],\n            \"compilations\": [],\n            \"draft_status\": \"published\",\n            \"beauty_url\": null,\n            \"thumbnail_url\": \"https://img.buzzfeed.com/thumbnailer-prod-us-east-1/video-api/assets/445157.jpg\",\n            \"thumbnail_alt_text\": \"\",\n            \"facebook_posts\": [],\n            \"language\": \"eng\",\n            \"seo_path\": null,\n            \"servings_noun_singular\": \"serving\",\n            \"tips_and_ratings_enabled\": true,\n            \"num_servings\": 6,\n            \"seo_title\": \"\",\n            \"approved_at\": 1683741492,\n            \"renditions\": [\n                {\n                    \"bit_rate\": 1774,\n                    \"aspect\": \"portrait\",\n                    \"width\": 404,\n                    \"name\": \"mp4_404x720\",\n                    \"container\": \"mp4\",\n                    \"file_size\": 7046743,\n                    \"url\": \"https://vid.tasty.co/output/288174/square_720/1683578877\",\n                    \"duration\": 31789,\n                    \"maximum_bit_rate\": null,\n                    \"height\": 720,\n                    \"poster_url\": \"https://img.buzzfeed.com/video-transcoder-prod/output/288174/square_720/1683578877_00001.png\",\n                    \"content_type\": \"video/mp4\",\n                    \"minimum_bit_rate\": null\n                },\n                {\n                    \"aspect\": \"portrait\",\n                    \"width\": 180,\n                    \"minimum_bit_rate\": null,\n                    \"height\": 320,\n                    \"container\": \"mp4\",\n                    \"url\": \"https://vid.tasty.co/output/288174/square_320/1683578877\",\n                    \"duration\": 31789,\n                    \"content_type\": \"video/mp4\",\n                    \"name\": \"mp4_180x320\",\n                    \"maximum_bit_rate\": null,\n                    \"poster_url\": \"https://img.buzzfeed.com/video-transcoder-prod/output/288174/square_320/1683578877_00001.png\",\n                    \"file_size\": 2408653,\n                    \"bit_rate\": 607\n                },\n                {\n                    \"name\": \"mp4_404x720\",\n                    \"height\": 720,\n                    \"poster_url\": \"https://img.buzzfeed.com/video-transcoder-prod/output/288174/landscape_720/1683578877_00001.png\",\n                    \"url\": \"https://vid.tasty.co/output/288174/landscape_720/1683578877\",\n                    \"bit_rate\": 1771,\n                    \"content_type\": \"video/mp4\",\n                    \"aspect\": \"portrait\",\n                    \"width\": 404,\n                    \"container\": \"mp4\",\n                    \"file_size\": 7037031,\n                    \"duration\": 31789,\n                    \"minimum_bit_rate\": null,\n                    \"maximum_bit_rate\": null\n                },\n                {\n                    \"file_size\": 4027034,\n                    \"url\": \"https://vid.tasty.co/output/288174/landscape_480/1683578877\",\n                    \"duration\": 31789,\n                    \"bit_rate\": 1014,\n                    \"content_type\": \"video/mp4\",\n                    \"name\": \"mp4_270x480\",\n                    \"height\": 480,\n                    \"container\": \"mp4\",\n                    \"poster_url\": \"https://img.buzzfeed.com/video-transcoder-prod/output/288174/landscape_480/1683578877_00001.png\",\n                    \"aspect\": \"portrait\",\n                    \"width\": 270,\n                    \"minimum_bit_rate\": null,\n                    \"maximum_bit_rate\": null\n                },\n                {\n                    \"url\": \"https://vid.tasty.co/output/288174/hls24_1683578877.m3u8\",\n                    \"duration\": 31824,\n                    \"width\": 608,\n                    \"minimum_bit_rate\": 270,\n                    \"name\": \"low\",\n                    \"maximum_bit_rate\": 2893,\n                    \"height\": 1080,\n                    \"container\": \"ts\",\n                    \"file_size\": null,\n                    \"bit_rate\": null,\n                    \"content_type\": \"application/vnd.apple.mpegurl\",\n                    \"aspect\": \"portrait\",\n                    \"poster_url\": \"https://img.buzzfeed.com/video-transcoder-prod/output/288174/1445289064805-h2exzu/1683578877_00001.png\"\n                }\n            ],\n            \"topics\": [\n                {\n                    \"name\": \"Romantic Dinners\",\n                    \"slug\": \"romantic-dinners\"\n                },\n                {\n                    \"name\": \"Desserts\",\n                    \"slug\": \"desserts\"\n                },\n                {\n                    \"name\": \"Japanese\",\n                    \"slug\": \"japanese\"\n                }\n            ],\n            \"brand\": null,\n            \"sections\": [\n                {\n                    \"components\": [\n                        {\n                            \"id\": 99417,\n                            \"position\": 1,\n                            \"measurements\": [\n                                {\n                                    \"unit\": {\n                                        \"name\": \"\",\n                                        \"display_plural\": \"\",\n                                        \"display_singular\": \"\",\n                                        \"abbreviation\": \"\",\n                                        \"system\": \"none\"\n                                    },\n                                    \"quantity\": \"10\",\n                                    \"id\": 733102\n                                }\n                            ],\n                            \"raw_text\": \"-10 large egg yolks\",\n                            \"extra_comment\": \"\",\n                            \"ingredient\": {\n                                \"updated_at\": 1520451538,\n                                \"name\": \"large egg yolks\",\n                                \"created_at\": 1520451538,\n                                \"display_plural\": \"large egg yolks\",\n                                \"id\": 3839,\n                                \"display_singular\": \"large egg yolk\"\n                            }\n                        },\n                        {\n                            \"raw_text\": \"-¾-1 cup plus 6 Tbsp granulated sugar, divided\",\n                            \"extra_comment\": \"or more to taste, plus 6 tablespoons, divided\",\n                            \"ingredient\": {\n                                \"name\": \"granulated sugar\",\n                                \"created_at\": 1494989637,\n                                \"display_plural\": \"granulated sugars\",\n                                \"id\": 419,\n                                \"display_singular\": \"granulated sugar\",\n                                \"updated_at\": 1509035262\n                            },\n                            \"id\": 99418,\n                            \"position\": 2,\n                            \"measurements\": [\n                                {\n                                    \"unit\": {\n                                        \"display_singular\": \"cup\",\n                                        \"abbreviation\": \"c\",\n                                        \"system\": \"imperial\",\n                                        \"name\": \"cup\",\n                                        \"display_plural\": \"cups\"\n                                    },\n                                    \"quantity\": \"¾\",\n                                    \"id\": 733099\n                                },\n                                {\n                                    \"unit\": {\n                                        \"system\": \"metric\",\n                                        \"name\": \"gram\",\n                                        \"display_plural\": \"g\",\n                                        \"display_singular\": \"g\",\n                                        \"abbreviation\": \"g\"\n                                    },\n                                    \"quantity\": \"150\",\n                                    \"id\": 733098\n                                }\n                            ]\n                        },\n                        {\n                            \"measurements\": [\n                                {\n                                    \"unit\": {\n                                        \"system\": \"imperial\",\n                                        \"name\": \"cup\",\n                                        \"display_plural\": \"cups\",\n                                        \"display_singular\": \"cup\",\n                                        \"abbreviation\": \"c\"\n                                    },\n                                    \"quantity\": \"4\",\n                                    \"id\": 733101\n                                },\n                                {\n                                    \"unit\": {\n                                        \"system\": \"metric\",\n                                        \"name\": \"milliliter\",\n                                        \"display_plural\": \"mL\",\n                                        \"display_singular\": \"mL\",\n                                        \"abbreviation\": \"mL\"\n                                    },\n                                    \"quantity\": \"960\",\n                                    \"id\": 733100\n                                }\n                            ],\n                            \"raw_text\": \"-4 cups heavy cream\",\n                            \"extra_comment\": \"\",\n                            \"ingredient\": {\n                                \"id\": 221,\n                                \"display_singular\": \"heavy cream\",\n                                \"updated_at\": 1509035278,\n                                \"name\": \"heavy cream\",\n                                \"created_at\": 1494214054,\n                                \"display_plural\": \"heavy creams\"\n                            },\n                            \"id\": 99419,\n                            \"position\": 3\n                        },\n                        {\n                            \"raw_text\": \"-3 tsp pandan extract\",\n                            \"extra_comment\": \"\",\n                            \"ingredient\": {\n                                \"id\": 8341,\n                                \"display_singular\": \"pandan extract\",\n                                \"updated_at\": 1620752292,\n                                \"name\": \"pandan extract\",\n                                \"created_at\": 1620752292,\n                                \"display_plural\": \"pandan extracts\"\n                            },\n                            \"id\": 99420,\n                            \"position\": 4,\n                            \"measurements\": [\n                                {\n                                    \"unit\": {\n                                        \"display_singular\": \"teaspoon\",\n                                        \"abbreviation\": \"tsp\",\n                                        \"system\": \"imperial\",\n                                        \"name\": \"teaspoon\",\n                                        \"display_plural\": \"teaspoons\"\n                                    },\n                                    \"quantity\": \"3\",\n                                    \"id\": 733105\n                                }\n                            ]\n                        },\n                        {\n                            \"ingredient\": {\n                                \"updated_at\": 1509035284,\n                                \"name\": \"vanilla extract\",\n                                \"created_at\": 1493745620,\n                                \"display_plural\": \"vanilla extracts\",\n                                \"id\": 103,\n                                \"display_singular\": \"vanilla extract\"\n                            },\n                            \"id\": 99421,\n                            \"position\": 5,\n                            \"measurements\": [\n                                {\n                                    \"unit\": {\n                                        \"system\": \"imperial\",\n                                        \"name\": \"teaspoon\",\n                                        \"display_plural\": \"teaspoons\",\n                                        \"display_singular\": \"teaspoon\",\n                                        \"abbreviation\": \"tsp\"\n                                    },\n                                    \"quantity\": \"2\",\n                                    \"id\": 733103\n                                }\n                            ],\n                            \"raw_text\": \"-2 tsp vanilla extract\",\n                            \"extra_comment\": \"\"\n                        },\n                        {\n                            \"id\": 99422,\n                            \"position\": 6,\n                            \"measurements\": [\n                                {\n                                    \"unit\": {\n                                        \"abbreviation\": \"c\",\n                                        \"system\": \"imperial\",\n                                        \"name\": \"cup\",\n                                        \"display_plural\": \"cups\",\n                                        \"display_singular\": \"cup\"\n                                    },\n                                    \"quantity\": \"2\",\n                                    \"id\": 733107\n                                },\n                                {\n                                    \"unit\": {\n                                        \"system\": \"metric\",\n                                        \"name\": \"milliliter\",\n                                        \"display_plural\": \"mL\",\n                                        \"display_singular\": \"mL\",\n                                        \"abbreviation\": \"mL\"\n                                    },\n                                    \"quantity\": \"480\",\n                                    \"id\": 733106\n                                }\n                            ],\n                            \"raw_text\": \"-2 cups hot water (for baking)\",\n                            \"extra_comment\": \"for baking\",\n                            \"ingredient\": {\n                                \"display_plural\": \"hot waters\",\n                                \"id\": 1112,\n                                \"display_singular\": \"hot water\",\n                                \"updated_at\": 1509035207,\n                                \"name\": \"hot water\",\n                                \"created_at\": 1496348177\n                            }\n                        },\n                        {\n                            \"id\": 99423,\n                            \"position\": 7,\n                            \"measurements\": [\n                                {\n                                    \"unit\": {\n                                        \"abbreviation\": \"\",\n                                        \"system\": \"none\",\n                                        \"name\": \"\",\n                                        \"display_plural\": \"\",\n                                        \"display_singular\": \"\"\n                                    },\n                                    \"quantity\": \"6\",\n                                    \"id\": 733108\n                                }\n                            ],\n                            \"raw_text\": \"-6 ice cubes\",\n                            \"extra_comment\": \"\",\n                            \"ingredient\": {\n                                \"updated_at\": 1509035210,\n                                \"name\": \"ice cube\",\n                                \"created_at\": 1496283352,\n                                \"display_plural\": \"ice cubes\",\n                                \"id\": 1074,\n                                \"display_singular\": \"ice cube\"\n                            }\n                        },\n                        {\n                            \"extra_comment\": \"for garnish\",\n                            \"ingredient\": {\n                                \"updated_at\": 1683739055,\n                                \"name\": \"fruit of choice\",\n                                \"created_at\": 1683739055,\n                                \"display_plural\": \"fruits of choice\",\n                                \"id\": 11206,\n                                \"display_singular\": \"fruit of choice\"\n                            },\n                            \"id\": 99424,\n                            \"position\": 8,\n                            \"measurements\": [\n                                {\n                                    \"unit\": {\n                                        \"system\": \"none\",\n                                        \"name\": \"\",\n                                        \"display_plural\": \"\",\n                                        \"display_singular\": \"\",\n                                        \"abbreviation\": \"\"\n                                    },\n                                    \"quantity\": \"0\",\n                                    \"id\": 733104\n                                }\n                            ],\n                            \"raw_text\": \"-Fruit of choice, for garnish\"\n                        }\n                    ],\n                    \"name\": null,\n                    \"position\": 1\n                }\n            ],\n            \"created_at\": 1683665801,\n            \"inspired_by_url\": null,\n            \"updated_at\": 1683741540,\n            \"original_video_url\": \"https://s3.amazonaws.com/video-api-prod/assets/68b5bf3400c34e43974241ad544c315f/Pandan.mp4\",\n            \"keywords\": \", dessert, pandan\",\n            \"show_id\": 17,\n            \"name\": \"Pandan Crème Brûlée\",\n            \"aspect_ratio\": \"9:16\",\n            \"show\": {\n                \"id\": 17,\n                \"name\": \"Tasty\"\n            },\n            \"description\": \"Have you ever tried pandan? Pandan is a plant used in many Asian cuisines, prized for its vibrant green leaves! It tastes like the love child of grass, vanilla, and coconut–super delish! This is probably the best crème brûlée I’ve ever had and pandan is truly the star of the show. I experimented with different ways of adding more pandan to the dish, but to be honest, using pandan extract was the easiest method, it yielded the creamiest outcome, AND had the best flavor.\",\n            \"video_url\": \"https://vid.tasty.co/output/288174/hls24_1683578877.m3u8\",\n            \"nutrition_visibility\": \"auto\",\n            \"user_ratings\": {\n                \"count_positive\": 0,\n                \"score\": null,\n                \"count_negative\": 0\n            },\n            \"id\": 8660,\n            \"brand_id\": null,\n            \"tags\": [\n                {\n                    \"id\": 64449,\n                    \"display_name\": \"French\",\n                    \"type\": \"european\",\n                    \"root_tag_type\": \"cuisine\",\n                    \"name\": \"french\"\n                },\n                {\n                    \"type\": \"asian\",\n                    \"root_tag_type\": \"cuisine\",\n                    \"name\": \"japanese\",\n                    \"id\": 64454,\n                    \"display_name\": \"Japanese\"\n                },\n                {\n                    \"root_tag_type\": \"cuisine\",\n                    \"name\": \"korean\",\n                    \"id\": 64455,\n                    \"display_name\": \"Korean\",\n                    \"type\": \"asian\"\n                },\n                {\n                    \"root_tag_type\": \"cuisine\",\n                    \"name\": \"vietnamese\",\n                    \"id\": 64461,\n                    \"display_name\": \"Vietnamese\",\n                    \"type\": \"asian\"\n                },\n                {\n                    \"type\": \"meal\",\n                    \"root_tag_type\": \"meal\",\n                    \"name\": \"desserts\",\n                    \"id\": 64485,\n                    \"display_name\": \"Desserts\"\n                },\n                {\n                    \"root_tag_type\": \"seasonal\",\n                    \"name\": \"date_night\",\n                    \"id\": 64500,\n                    \"display_name\": \"Date Night\",\n                    \"type\": \"occasion\"\n                },\n                {\n                    \"root_tag_type\": \"appliance\",\n                    \"name\": \"stove_top\",\n                    \"id\": 65848,\n                    \"display_name\": \"Stove Top\",\n                    \"type\": \"appliance\"\n                },\n                {\n                    \"root_tag_type\": \"occasion\",\n                    \"name\": \"indulgent_sweets\",\n                    \"id\": 65850,\n                    \"display_name\": \"Indulgent Sweets\",\n                    \"type\": \"occasion\"\n                },\n                {\n                    \"root_tag_type\": \"seasonal\",\n                    \"name\": \"special_occasion\",\n                    \"id\": 188967,\n                    \"display_name\": \"Special Occasion\",\n                    \"type\": \"occasion\"\n                },\n                {\n                    \"root_tag_type\": \"business_tags\",\n                    \"name\": \"one_top_app_dessert\",\n                    \"id\": 2651758,\n                    \"display_name\": \"Dessert\",\n                    \"type\": \"business_tags\"\n                },\n                {\n                    \"root_tag_type\": \"cuisine\",\n                    \"name\": \"filipino\",\n                    \"id\": 6953008,\n                    \"display_name\": \"Filipino\",\n                    \"type\": \"asian\"\n                }\n            ],\n            \"credits\": [\n                {\n                    \"name\": \"Sarah Banh\",\n                    \"type\": \"internal\"\n                }\n            ]\n        }\n    ]\n}");
  return response;
}

app.get('/', (req, res) => {
  res.render('index');
});

app.get('/recipes', async (req, res) => {
  console.log('test');
  let data = await getRecipesList(0, 1, "", "egg");
  console.log(data);
  res.send(data);
})
